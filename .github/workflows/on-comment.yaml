name: on-comment

on:
  issue_comment:
    types:
      - created

permissions:
  contents: read
  checks: read
  pull-requests: read

jobs:
  dispatch-on-comment:
    runs-on: ubuntu-latest
    # Run this workflow only if someone comments 'deploy' on a Pull Request
    if: github.event.issue.pull_request && github.event.comment.body == 'deploy'
    steps:
      - uses: actions/checkout@v3
      # Issue comment is not directly linked to Pull Request Branch, use custom github-script based action
      - name: Get Pull Request Head SHA
        id: get-sha
        uses: ./.github/workflows/pr-branch-info
        with:
          issue-number: ${{ github.event.issue.number }}
      # Check if other builds are complete
      - name: Dispatch
        uses: actions/github-script@v6
        with:
          script: |
            const workflows = await github.request('GET /repos/{owner}/{repo}/actions/workflows', {
              owner: context.repo.owner,
              repo: context.repo.repo
            });
            console.log(workflows)
